<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My AI Chat Page</title>
</head>
<body>

  <h1>Tervetuloa Arctic AI-botti esittelysivulle</h1>
  <p>TÃ¤llÃ¤ sivulla esitellÃ¤Ã¤n eri bottiteknologioita. <br>
  Toiminnallisuudet omissa bokseissaan niin voit valita testata ja valita haluamasi palikat</p>

<!-- ğŸ” Vaihe 1: Datan tarkistus -->
<div id="check-box" style="max-width:600px;margin:40px 0 0 20px;padding:20px;border:1px solid #ddd;border-radius:8px;font-family:sans-serif;">
  <h3>Vaihe 1: Tarkista verkkosivuston sisÃ¤ltÃ¶, jota haluat kÃ¤yttÃ¤Ã¤ chatbotin datalÃ¤hteenÃ¤</h3>
  <p>
    Data Crawler. Muista kÃ¤ynnistÃ¤Ã¤ paikallinen palvelu. datasizecheck.py<br>
    Tarkistetaan haluamasi datalÃ¤hdesivun sisÃ¤ltÃ¶.<br>
    Anna URL (esim. https://oamkjournal.oamk.fi/)
  </p>

  <input type="text" id="url-input" placeholder="https://..." style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;" />

  <button onclick="checkDataAmount()" style="margin-top:10px;width:100%;padding:10px;background:#17a2b8;color:white;border:none;border-radius:4px;cursor:pointer;">
    Tarkista antamasi URL:n data (200 uusinta sivua)
  </button>

  <div id="vector-status" style="margin-top:15px;color:#333;"></div>
</div>

<!-- 
Tarkista datan sisÃ¤ltÃ¶ ja mÃ¤Ã¤rÃ¤ valitulla websivulla. 
Oletetaan:
Yksi embedding-vektori (per chunk) on 384 tai 768 float32-arvoa
Yksi float32 = 4 tavua (bytes)
Yksi vektori = dim * 4 bytes
Kokonaiskoko = vektorien mÃ¤Ã¤rÃ¤ Ã— dim Ã— 4

Eli koko olisi:
tokens â†’ arvioi chunk-mÃ¤Ã¤rÃ¤
chunk_count Ã— dim Ã— 4 â†’ koko tavuina
Esim. 128 chunks Ã— 384 Ã— 4 = 196,608 bytes â‰ˆ 0.19 MB
-->
  
<script>
  async function checkDataAmount() {
    const url = document.getElementById("url-input").value;
    const status = document.getElementById("vector-status");
    status.innerHTML = "ğŸ”„ Haetaan tietoa sivustolta...";

    try {
      const res = await fetch("http://localhost:8000/crawl-check-data?url=" + encodeURIComponent(url));
      const data = await res.json();

      if (data.error) {
        status.innerHTML = `âŒ Virhe: ${data.error}`;
        return;
      }

      // ğŸ”§ Varmistetaan ettÃ¤ data on olemassa ennen kÃ¤yttÃ¶Ã¤
      const chars = data.chars ?? 0;
      const tokens = data.tokens ?? 0;
      const estimatedChunks = data.estimated_chunks ?? 0;
      const totalBytes = data.estimated_size_bytes ?? 0;
      const totalMB = data.estimated_size_mb ?? 0;
      const pages = data.pages_crawled ?? "?";
      const structure = data.structure ?? [];

    // ğŸ” Rakenna sivulista
    let structureList = "<ul>";
    structure.forEach(link => {
      structureList += `<li><a href="${link}" target="_blank">${link}</a></li>`;
    });
    structureList += "</ul>";

    // ğŸ–¥ï¸ NÃ¤ytÃ¤ kaikki tiedot
    status.innerHTML = `
      âœ… Tarkistettu sivusto: <strong>${url}</strong><br><br>
      ğŸ“„ MerkkejÃ¤: <strong>${chars.toLocaleString()}</strong><br>
      ğŸ“ Sanoja: <strong>${tokens.toLocaleString()}</strong><br>
      ğŸ§  Arvioitu vektorointikoko: <strong>${estimatedChunks}</strong> palaa<br>
      ğŸ’¾ Arvioitu koko: <strong>${totalMB} MB</strong> (${totalBytes.toLocaleString()} tavua)<br>
      ğŸ”— Sivujen mÃ¤Ã¤rÃ¤: <strong>${pages}</strong><br><br>
      ğŸ§­ <strong>Sivuston rakenne (sivut, joissa yli 100 sanaa):</strong><br>
      ${structureList}
      `;

    } catch (err) {
      status.innerHTML = `<span style="color:red;">âŒ Virhe: ${err.message}</span>`;
    }
  }
</script>

<!-- --------------------------------------------------------------------------------------------------------------->
<!-- Vaihe 2: Datan vektorointi -->
<div id="vectorization-box" style="max-width:600px;margin:20px 0 40px 20px;padding:20px;border:1px solid #ddd;border-radius:8px;font-family:sans-serif;">
  <h3>Vaihe 2: Hakubotin kÃ¤yttÃ¤mÃ¤n datan vektorointi</h3>
  <p>
    AI-hakubotti toimii tehokkaasti, kun kaikki kÃ¤ytettÃ¤vÃ¤ tieto on <strong>vektoroitu</strong>, eli muunnettu numeromuotoon vektoreihin.<br>
    Vektorointi tehdÃ¤Ã¤n <strong>aina etukÃ¤teen</strong>, ei joka haun yhteydessÃ¤, sillÃ¤ se vie prosessointitehoa ja aikaa. <br>
    Voit tarkistaa yllÃ¤olevalla palvelulla datan mÃ¤Ã¤rÃ¤n ja sisÃ¤llÃ¶n ennen kuin kÃ¤ynnistÃ¤t varsinaisen vektoroinnin.<br><br>
    TÃ¤mÃ¤ muuntaa tekstidatan numeeriseen muotoon ja tallentaa sen kÃ¤ytettÃ¤vÃ¤ksi AI-hakubotissa.
  </p>
  
  <!-- Kansion valinta -->
<input type="text" id="subfolder-input" placeholder="Tallenna kansioon, esim. oamkjournal" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;margin-bottom:10px;" />

<!-- URL valinta -->
<input type="text" id="source-url" placeholder="MistÃ¤ URL:sta vektoroidaan, esim. https://oamkjournal.oamk.fi/" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;" />

<!-- Vektorointi-nappi -->
<button onclick="submitVectorization()" style="margin-top:10px;width:100%;padding:10px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer;">
  KÃ¤ynnistÃ¤ vektorointi
</button>

<!-- Tila -->
<p id="vectorize-status" style="margin-top:10px;color:green;font-weight:bold;"></p>

<script>
  async function submitVectorization() {
    const folder = document.getElementById("subfolder-input").value.trim();
    const url = document.getElementById("source-url").value.trim();
    const status = document.getElementById("vectorize-status");

    // Alusta
    status.style.color = "red";
    status.textContent = "";

    // âœ… 1. Tarkista tyhjÃ¤t kentÃ¤t
    if (!folder || !url) {
      status.textContent = "âš ï¸ Molemmat kentÃ¤t ovat pakollisia.";
      return;
    }

    // âœ… 2. Tarkista URL-muoto
    if (!url.startsWith("http://") && !url.startsWith("https://")) {
      status.textContent = "âš ï¸ URL pitÃ¤Ã¤ alkaa http:// tai https://";
      return;
    }

    // âœ… 3. Tarkista ettÃ¤ URL on saavutettavissa backendin kautta
    try {
      status.textContent = "ğŸ” Tarkistetaan URL...";
      const checkRes = await fetch(`http://localhost:8000/check-url?url=${encodeURIComponent(url)}`);
      const checkData = await checkRes.json();

      if (checkData.error) {
        status.textContent = `âš ï¸ URL ei toimi: ${checkData.error}`;
        return;
      }
      if (checkData.status < 200 || checkData.status >= 400) {
        status.textContent = `âš ï¸ URL palautti statuksen ${checkData.status}`;
        return;
      }
    } catch (err) {
      status.textContent = `âš ï¸ URL-tarkistus epÃ¤onnistui: ${err.message}`;
      return;
    }

    // âœ… 4. LÃ¤hetÃ¤ vektorointipyyntÃ¶
    try {
      status.style.color = "black";
      status.textContent = "ğŸ”„ Vektorointi kÃ¤ynnissÃ¤...";
      const res = await fetch(`http://localhost:8000/vectorize?url=${encodeURIComponent(url)}&folder=${encodeURIComponent(folder)}`);
      const data = await res.json();

      if (data.error) {
        status.style.color = "red";
        status.textContent = `âŒ Virhe: ${data.error}`;
      } else {
        status.style.color = "green";
        status.textContent = `âœ… ${data.pages} sivua vektoroitu. Tallennettu: ${data.path}`;
      }
    } catch (err) {
      status.style.color = "red";
      status.textContent = `âŒ Yhteysvirhe: ${err.message}`;
    }
  }
</script>
</div>


<div style="margin-top:20px; font-family:sans-serif;">
  <h4>MitÃ¤ on vektorointi?</h4>
  <p>
    Lue lisÃ¤Ã¤ siitÃ¤, mitÃ¤ tekstin vektorointi tarkoittaa ja miten se liittyy tekoÃ¤lyyn ja hakubotteihin:
    <br>
    <a href="https://fi.linux-console.net/?p=26093#gsc.tab=0" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://fi.linux-console.net/?p=26093#gsc.tab=0
    </a>
  </p>
</div>

<div style="margin-top:20px; font-family:sans-serif;">
  <h4><br><br>Miten vektroidusta datasta ja kysymyksestÃ¤ muodostetaan vastaus?</h4>
  <p>
    AI-hakubotti kÃ¤yttÃ¤Ã¤ vektoroitua dataa ja kÃ¤yttÃ¤jÃ¤n kysymystÃ¤ muodostaakseen kontekstuaalisen vastauksen. <br>
    TÃ¤mÃ¤n mahdollistaa ns. RAG-arkkitehtuuri (Retrieval-Augmented Generation), jossa: <br>
    1. KÃ¤yttÃ¤jÃ¤n kysymykselle lasketaan embedding eli numerosarja.<br>
    2. EmbeddingiÃ¤ verrataan tallennettuihin tekstipaloihin, jotka on vektoroitu etukÃ¤teen .jsonl-tiedostoon.<br>
    3. Parhaiten vastaavat tekstit haetaan ja yhdistetÃ¤Ã¤n yhdeksi "kontekstiksi".<br>
    4. TÃ¤mÃ¤ konteksti + kysymys syÃ¶tetÃ¤Ã¤n paikalliselle kielimallille, joka muodostaa vastauksen.<br>
    <br>
    âš™ï¸ Paikallinen kielimalli: Ollama <br>
    Hakubotti kÃ¤yttÃ¤Ã¤ Ollama-kielimallimoottoria (LLM), joka toimii tÃ¤ysin paikallisesti. <br>
    Ollama tarjoaa moderneja malleja kuten llama3, mistral ja gemma, joita voidaan kÃ¤yttÃ¤Ã¤ ilman verkkoyhteyttÃ¤. <br>
    <br>
    ğŸ”½ Ollaman asennus Windowsiin: <br>
    1. Lataa osoitteesta:
    <a href="https://ollama.com/download" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://ollama.com/download
    </a><br>
    2. Asenna ohjelma ja kÃ¤ynnistÃ¤ Ollama <br>
    3. Aja haluamasi kielimalli (esim. llama3) komentorivillÃ¤: "ollama run llama3" <br><br>
    Kun malli on kÃ¤ynnissÃ¤, botti pystyy kÃ¤yttÃ¤mÃ¤Ã¤n sitÃ¤ paikallisesti kysymysten tulkitsemiseen ja vastausten tuottamiseen <br>
    ilman pilvipalveluita tai ulkopuolisia API-yhteyksiÃ¤. TÃ¤mÃ¤ parantaa tietoturvaa ja nopeutta. <br>
  </p>
</div>


<div style="margin-top:20px; font-family:sans-serif;">
  <h4><br><br>Aja kielimallia paikallisesti Dockerissa.</h4>
  <p>
    Docker, eli kontti on teknologia, joka tarjoaa eristetyn ajoympÃ¤ristÃ¶n sovelluksille. <br>
    TÃ¤ssÃ¤ tapauksessa voit ajaa kielimallia, eli LLM:Ã¤Ã¤ joka muodostaa sinulle vastaukset "kontissa" <br>
    MikÃ¤ on Docker Container, eli suomeksi kontti: <br>
    ğŸ‘‰ <a href="https://docs.docker.com/desktop/" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://docs.docker.com/desktop/ <br>
    </a><br>
    Dockerin kÃ¤yttÃ¶Ã¤ varten asenna Docker Desktop tÃ¤Ã¤ltÃ¤: <br>
    ğŸ‘‰ <a href="https://www.docker.com/products/docker-desktop/" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://www.docker.com/products/docker-desktop/ <br>
    </a><br>
    
  </p>
</div>


<!-- Widget rajapinta. Hakuboksi -->
 <script src="site-widget.js"></script>



</body>
</html>