<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My AI Chat Page</title>
</head>
<body>

  <h1>Tervetuloa Arctic AI-botti esittelysivulle</h1>
  <p>
    T√§ll√§ sivulla esitell√§√§n eri bottiteknologioita. <br>
    Toiminnallisuudet omissa bokseissaan niin voit valita testata ja valita haluamasi palikat<br>
    N√§m√§ on tarkoituskin olla paikallisesti ajettavia niin ei valitettavasti toimi suoraan t√§st√§, vaan <br>
    joudut menem√§√§n ohjeiden mukaan ja pystytt√§m√§√§n ymp√§rist√∂n omaan haluttuun ymp√§rist√∂√∂si<br>
  </p>

<!-- üîç Vaihe 1: Datan tarkistus -->
<div id="check-box" style="max-width:600px;margin:40px 0 0 20px;padding:20px;border:1px solid #ddd;border-radius:8px;font-family:sans-serif;">
  <h3>Website Crawler. <br>
    Palvelu, jolla voit lukea verkkosivuston sis√§ll√∂n, jota haluat k√§ytt√§√§ oman chatbotin datal√§hteen√§</h3>
  <p>
    Mik√§li haluat k√§ytt√§√§ jotain tietty√§ sivua datal√§hteen√§,<br>
    tarkista t√§ll√§ palvelulla ensin onko sivustolla yleens√§k√§√§n dataa saatavilla. <br><br>
    T√§m√§ palvelu listaa antamasi verkko-osoitteen sivustot, <br>
    joissa v√§hint√§√§n 100 sanaa, eli tulkitaan merkitt√§viksi. <br>
    Jos et saa alasivulistausta alle, sivustolla ei ole saatavissa merkitt√§vi√§ tietoja. <br><br>
    Anna osoite, jonka haluat testata. (esim. https://oamkjournal.oamk.fi/)
  </p>

  <input type="text" id="url-input" placeholder="https://..." style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;" />

  <button onclick="checkDataAmount()" style="margin-top:10px;width:100%;padding:10px;background:#17a2b8;color:white;border:none;border-radius:4px;cursor:pointer;">
    Tarkista antamasi verkkosivun kansiorakenne (300 uusinta sivua, joissa v√§hint√§√§n 100 sanaa)
  </button>

  <div id="vector-status" style="margin-top:15px;color:#333;"></div>
</div>

<!-- 
Tarkista datan sis√§lt√∂ ja m√§√§r√§ valitulla websivulla. 
Oletetaan:
Yksi embedding-vektori (per chunk) on 384 tai 768 float32-arvoa
Yksi float32 = 4 tavua (bytes)
Yksi vektori = dim * 4 bytes
Kokonaiskoko = vektorien m√§√§r√§ √ó dim √ó 4

Eli koko olisi:
tokens ‚Üí arvioi chunk-m√§√§r√§
chunk_count √ó dim √ó 4 ‚Üí koko tavuina
Esim. 128 chunks √ó 384 √ó 4 = 196,608 bytes ‚âà 0.19 MB
-->
  
<script>
  async function checkDataAmount() {
    const url = document.getElementById("url-input").value;
    const status = document.getElementById("vector-status");
    status.innerHTML = "üîÑ Haetaan tietoa sivustolta...";

    try {
      const res = await fetch("http://localhost:8000/crawl-check-data?url=" + encodeURIComponent(url));
      const data = await res.json();

      if (data.error) {
        status.innerHTML = `‚ùå Virhe: ${data.error}`;
        return;
      }

      // üîß Varmistetaan ett√§ data on olemassa ennen k√§ytt√∂√§
      const chars = data.chars ?? 0;
      const tokens = data.tokens ?? 0;
      const estimatedChunks = data.estimated_chunks ?? 0;
      const totalBytes = data.estimated_size_bytes ?? 0;
      const totalMB = data.estimated_size_mb ?? 0;
      const pages = data.pages_crawled ?? "?";
      const structure = data.structure ?? [];

    // üîé Rakenna sivulista
    let structureList = "<ul>";
    structure.forEach(link => {
      structureList += `<li><a href="${link}" target="_blank">${link}</a></li>`;
    });
    structureList += "</ul>";

    // üñ•Ô∏è N√§yt√§ kaikki tiedot
    status.innerHTML = `
      ‚úÖ Tarkistettu sivusto: <strong>${url}</strong><br><br>
      üìÑ Merkkej√§: <strong>${chars.toLocaleString()}</strong><br>
      üìù Sanoja: <strong>${tokens.toLocaleString()}</strong><br>
      üß† Arvioitu vektorointikoko: <strong>${estimatedChunks}</strong> palaa<br>
      üíæ Arvioitu koko: <strong>${totalMB} MB</strong> (${totalBytes.toLocaleString()} tavua)<br>
      üîó Sivujen m√§√§r√§: <strong>${pages}</strong><br><br>
      üß≠ <strong>Sivuston rakenne (sivut, joissa yli 100 sanaa):</strong><br>
      ${structureList}
      `;

    } catch (err) {
      status.innerHTML = `<span style="color:red;">‚ùå Virhe: ${err.message}</span>`;
    }
  }
</script>

<!-- --------------------------------------------------------------------------------------------------------------->
<!-- Vaihe 2: Datan vektorointi -->
<div id="vectorization-box" style="max-width:600px;margin:20px 0 40px 20px;padding:20px;border:1px solid #ddd;border-radius:8px;font-family:sans-serif;">
  <h3>Datan vektorointi paikalliseen tiedostoon. </h3>
  <p>
    AI-hakubotti toimii tehokkaasti, kun kaikki k√§ytett√§v√§ tieto on <strong>vektoroitu</strong>, eli muunnettu numeromuotoon vektoreihin.<br>
    Vektorointi tehd√§√§n <strong>aina etuk√§teen</strong>, ei joka haun yhteydess√§, sill√§ se vie prosessointitehoa ja aikaa. <br>
    Voit tarkistaa yll√§olevalla palvelulla datan m√§√§r√§n ja sis√§ll√∂n ennen kuin k√§ynnist√§t varsinaisen vektoroinnin.<br><br>
    T√§m√§ muuntaa tekstidatan numeeriseen muotoon ja tallentaa sen k√§ytett√§v√§ksi AI-hakubotissa.
  </p>
  
  <!-- Kansion valinta -->
<input type="text" id="subfolder-input" placeholder="Tallenna kansioon, esim. oamkjournal" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;margin-bottom:10px;" />

<!-- URL valinta -->
<input type="text" id="source-url" placeholder="Mist√§ URL:sta vektoroidaan, esim. https://oamkjournal.oamk.fi/" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;" />

<!-- Vektorointi-nappi -->
<button onclick="submitVectorization()" style="margin-top:10px;width:100%;padding:10px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer;">
  K√§ynnist√§ vektorointi
</button>

<!-- Tila -->
<p id="vectorize-status" style="margin-top:10px;color:green;font-weight:bold;"></p>

<script>
  async function submitVectorization() {
    const folder = document.getElementById("subfolder-input").value.trim();
    const url = document.getElementById("source-url").value.trim();
    const status = document.getElementById("vectorize-status");

    // Alusta
    status.style.color = "red";
    status.textContent = "";

    // ‚úÖ 1. Tarkista tyhj√§t kent√§t
    if (!folder || !url) {
      status.textContent = "‚ö†Ô∏è Molemmat kent√§t ovat pakollisia.";
      return;
    }

    // ‚úÖ 2. Tarkista URL-muoto
    if (!url.startsWith("http://") && !url.startsWith("https://")) {
      status.textContent = "‚ö†Ô∏è URL pit√§√§ alkaa http:// tai https://";
      return;
    }

    // ‚úÖ 3. Tarkista ett√§ URL on saavutettavissa backendin kautta
    try {
      status.textContent = "üîç Tarkistetaan URL...";
      const checkRes = await fetch(`http://localhost:8000/check-url?url=${encodeURIComponent(url)}`);
      const checkData = await checkRes.json();

      if (checkData.error) {
        status.textContent = `‚ö†Ô∏è URL ei toimi: ${checkData.error}`;
        return;
      }
      if (checkData.status < 200 || checkData.status >= 400) {
        status.textContent = `‚ö†Ô∏è URL palautti statuksen ${checkData.status}`;
        return;
      }
    } catch (err) {
      status.textContent = `‚ö†Ô∏è URL-tarkistus ep√§onnistui: ${err.message}`;
      return;
    }

    // ‚úÖ 4. L√§het√§ vektorointipyynt√∂
    try {
      status.style.color = "black";
      status.textContent = "üîÑ Vektorointi k√§ynniss√§...";
      const res = await fetch(`http://localhost:8000/vectorize?url=${encodeURIComponent(url)}&folder=${encodeURIComponent(folder)}`);
      const data = await res.json();

      if (data.error) {
        status.style.color = "red";
        status.textContent = `‚ùå Virhe: ${data.error}`;
      } else {
        status.style.color = "green";
        status.textContent = `‚úÖ ${data.pages} sivua vektoroitu. Tallennettu: ${data.path}`;
      }
    } catch (err) {
      status.style.color = "red";
      status.textContent = `‚ùå Yhteysvirhe: ${err.message}`;
    }
  }
</script>
</div>


<div style="margin-top:20px; font-family:sans-serif;">
  <h4>Mit√§ on vektorointi?</h4>
  <p>
    Lue lis√§√§ siit√§, mit√§ tekstin vektorointi tarkoittaa ja miten se liittyy teko√§lyyn ja hakubotteihin:
    <br>
    <a href="https://fi.linux-console.net/?p=26093#gsc.tab=0" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://fi.linux-console.net/?p=26093#gsc.tab=0
    </a>
  </p>
</div>

<div style="margin-top:20px; font-family:sans-serif;">
  <h4><br><br>Miten vektroidusta datasta ja kysymyksest√§ muodostetaan vastaus?</h4>
  <p>
    AI-hakubotti k√§ytt√§√§ vektoroitua dataa ja k√§ytt√§j√§n kysymyst√§ muodostaakseen kontekstuaalisen vastauksen. <br>
    T√§m√§n mahdollistaa ns. RAG-arkkitehtuuri (Retrieval-Augmented Generation), jossa: <br>
    1. K√§ytt√§j√§n kysymykselle lasketaan embedding eli numerosarja.<br>
    2. Embeddingi√§ verrataan tallennettuihin tekstipaloihin, jotka on vektoroitu etuk√§teen .jsonl-tiedostoon.<br>
    3. Parhaiten vastaavat tekstit haetaan ja yhdistet√§√§n yhdeksi "kontekstiksi".<br>
    4. T√§m√§ konteksti + kysymys sy√∂tet√§√§n paikalliselle kielimallille, joka muodostaa vastauksen.<br>
    <br>
    ‚öôÔ∏è Paikallinen kielimalli: Ollama <br>
    Hakubotti k√§ytt√§√§ Ollama-kielimallimoottoria (LLM), joka toimii t√§ysin paikallisesti. <br>
    Ollama tarjoaa moderneja malleja kuten llama3, mistral ja gemma, joita voidaan k√§ytt√§√§ ilman verkkoyhteytt√§. <br>
    <br>
    üîΩ Ollaman asennus Windowsiin: <br>
    1. Lataa osoitteesta:
    <a href="https://ollama.com/download" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://ollama.com/download
    </a><br>
    2. Asenna ohjelma ja k√§ynnist√§ Ollama <br>
    3. Aja haluamasi kielimalli (esim. llama3) komentorivill√§: "ollama run llama3" <br><br>
    Kun malli on k√§ynniss√§, botti pystyy k√§ytt√§m√§√§n sit√§ paikallisesti kysymysten tulkitsemiseen ja vastausten tuottamiseen <br>
    ilman pilvipalveluita tai ulkopuolisia API-yhteyksi√§. T√§m√§ parantaa tietoturvaa ja nopeutta. <br>
  </p>
</div>


<div style="margin-top:20px; font-family:sans-serif;">
  <h4><br><br>Aja kielimallia paikallisesti Dockerissa.</h4>
  <p>
    Docker, eli kontti on teknologia, joka tarjoaa eristetyn ajoymp√§rist√∂n sovelluksille. <br>
    T√§ss√§ tapauksessa voit ajaa kielimallia, eli LLM:√§√§ joka muodostaa sinulle vastaukset "kontissa" <br>
    Mik√§ on Docker Container, eli suomeksi kontti: <br>
    üëâ <a href="https://docs.docker.com/desktop/" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://docs.docker.com/desktop/ <br>
    </a><br>
    Dockerin k√§ytt√∂√§ varten asenna Docker Desktop t√§√§lt√§: <br>
    üëâ <a href="https://www.docker.com/products/docker-desktop/" target="_blank" style="color:#007bff; text-decoration:underline;">
      https://www.docker.com/products/docker-desktop/ <br>
      Jos virittelet t√§m√§n Windows koneellesi tai Windows-serverille niin <br>
      vaatii my√∂s WSL (Windows Subsystem Linux) asentamisen, koska docker toimii vain Linuxissa. <br>
    </a><br>
    
  </p>
</div>


<!-- Widget rajapinta. Hakuboksi -->
<script src="site-widget.js"></script>



</body>
</html>